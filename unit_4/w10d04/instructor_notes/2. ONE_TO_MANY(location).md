# One to Many Relationship in Rails

## Display the many inhabitants belonging to a location

In `app/models/location.rb`:

```ruby
class Location
    attr_reader :id, :street, :city, :state, :inhabitants # add inhabitants attr_reader

    DB = PG.connect(host: "localhost", port: 5432, dbname: 'contacts')

    def initialize(opts)
        @id = opts["id"].to_i
        @street = opts["street"]
        @city = opts["city"]
        @state = opts["state"]
        if opts["inhabitants"]
            @inhabitants = opts["inhabitants"]
        end
    end

    def self.all
        results = DB.exec(
            <<-SQL
                SELECT
                    locations.*,
                    people.id AS person_id,
                    people.name,
                    people.age
                FROM locations
                LEFT JOIN people
                ON locations.id = people.home_id
                ORDER BY locations.id ASC
            SQL
        )
        locations = []
        last_location_id = nil
        results.each do |result|
            if result["id"] != last_location_id
                locations.push(
                    Location.new({
                        "id" => result["id"],
                        "street" => result["street"],
                        "city" => result["city"],
                        "state" => result["state"],
                        "inhabitants" => []
                    })
                )
                last_location_id = result["id"]
            end
            if result["person_id"]
                new_person = Person.new({
                    "id" => result["person_id"],
                    "name" => result["name"],
                    "age" => result["age"],
                })
                locations.last.inhabitants.push(new_person)
            end
        end
        return locations
    end

    def self.find(id)
        results = DB.exec(
            <<-SQL
                SELECT
                    locations.*,
                    people.id AS person_id,
                    people.name,
                    people.age
                FROM locations
                LEFT JOIN people
                ON locations.id = people.home_id
                WHERE locations.id=#{id};
            SQL
        )
        inhabitants = []
        results.each do |result|
            if result["person_id"]
                inhabitants.push Person.new({
                    "id" => result["person_id"],
                    "name" => result["name"],
                    "age" => result["age"]
                })
            end
        end

        return Location.new({
            "id" => results.first["id"],
            "street" => results.first["street"],
            "city" => results.first["city"],
            "state" => results.first["state"],
            "inhabitants" => inhabitants
        })
    end
    #...
end
```
